---
title: 同步模式之保护性暂停
date: 2021-11-21 19:54:22
tags: Java并发
categories: java基础
---


# 定义：
即 Guarded Suspension，用在一个线程等待另一个线程的执行结果
要点
* 有一个结果需要从一个线程传递到另一个线程，让他们关联同一个 GuardedObject
* 如果有结果不断从一个线程到另一个线程那么可以使用消息队列（见生产者/消费者）
* JDK 中，join 的实现、Future 的实现，采用的就是此模式
* 因为要等待另一方的结果，因此归类到同步模式
![](https://gitee.com/haoyumaster/imageBed/raw/master/imgs/20211121195525.png)
```java
public class Test20 {
    public static void main(String[] args) {
        GuardedObject guardedObject = new GuardedObject();
        new Thread(()->{
            try {
                log.debug("执行");
                Object res=   guardedObject.get(2000);
                log.debug("结果为{}",res);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        },"t1").start();
        new Thread(()->{
            log.debug("执行");

            try {
                Thread.sleep(1000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }

            guardedObject.put(null);
        },"t1").start();
    }


}

class GuardedObject {
    private  Object response;

    public Object get(long timeOut) throws InterruptedException {
        synchronized (this){
            //经历时间
            long passTime=0;
            //开始时间
            long begin=System.currentTimeMillis();
            while (response==null){
                //等待时间=超时时间-经理时间
                long waitTime=timeOut-passTime;
                //经历的时间超过了最大等待时间，就会超时，退出循环
                if (waitTime<=0){
                    break;
                }
                this.wait(waitTime);
                passTime=System.currentTimeMillis()-begin;
            }
        }
        return response;
    }
    public  void put(Object response){
        synchronized (this){
            this.response=response;
            this.notifyAll();
        }

    }
}


```